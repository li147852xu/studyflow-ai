from __future__ import annotations

import streamlit as st

from core.ui_state.storage import get_setting

_STRINGS = {
    "en": {
        "app_title": "StudyFlow-AI",
        "nav_start": "Home",
        "nav_library": "Library",
        "nav_create": "Create Studio",
        "nav_tools": "Toolbox",
        "nav_help": "Help Center",
        "settings": "Settings",
        "exit_app": "Exit / Quit",
        "exit_choice": "Exit options",
        "exit_wait": "Wait for tasks to finish",
        "exit_force": "Force exit",
        "exit_shutting_down": "Shutting down... Please close browser tab manually.",
        "exit_tasks_running": "There are tasks running. They will be cancelled on exit.",
        "confirm_exit": "Confirm exit",
        "exit_confirm_prompt": "This will close the app. You can reopen the browser tab later.",
        "cancel_exit": "Cancel",
        "refresh_app": "Refresh",
        "project": "Project",
        "new_project": "(new project)",
        "new_project_name": "New project name",
        "create_project": "Create project",
        "navigation": "Navigation",
        "go_to": "Go to",
        "projects_caption": "Projects and navigation.",
        "project_select_help": "Choose an existing project or create a new one.",
        "project_created": "Project created.",
        "start_caption": "Import → Process → Ask or Generate",
        "library_caption": "Search, inspect, and manage your materials.",
        "create_caption": "Course Sprint, Paper Review, and Presentation Builder.",
        "tools_caption": "Coach, tasks, diagnostics, and settings in one place.",
        "tools_tabs": "Tools tabs",
        "inspector": "Inspector",
        "collapse_inspector": "Collapse inspector",
        "inspector_collapsed": "Inspector collapsed.",
        "status": "Status",
        "citations": "Citations",
        "no_citations": "No citations yet.",
        "no_output": "No output yet.",
        "exports": "Exports",
        "exports_center_title": "Exports",
        "exports_select_project": "Select a project to export or import.",
        "workspace_bundle": "Workspace bundle",
        "include_pdfs": "Include PDFs",
        "include_assets": "Include assets",
        "include_prompts": "Include prompts",
        "output_path_optional": "Output path (optional)",
        "export_bundle": "Export bundle",
        "bundle_exported": "Bundle exported: {path}",
        "import_bundle_path": "Import bundle path",
        "rebuild_index_after_import": "Rebuild index after import",
        "import_bundle": "Import bundle",
        "bundle_imported": "Bundle imported into workspace: {workspace}",
        "submission_pack": "Submission pack",
        "pack_type": "Pack type",
        "pack_type_slides": "Slides",
        "pack_type_exam": "Exam",
        "pack_type_related": "Related",
        "pack_source_id": "Source ID (document/course/project ID)",
        "build_pack": "Build pack",
        "pack_created": "Pack created: {path}",
        "versions": "Versions",
        "history": "History",
        "language": "Language",
        "output_language": "Output language",
        "output_language_help": "Controls the language of generated content.",
        "ui_language": "UI language",
        "ui_language_help": "Changes all interface text.",
        "theme_label": "Theme",
        "theme_light": "Light",
        "theme_dark": "Dark",
        "theme_help": "Switch between light and dark appearance.",
        "english": "English",
        "chinese": "Chinese",
        "model_unknown": "default model",
        "llm_generating": "Generating with {model}…",
        "llm_querying": "Searching and generating with {model}…",
        "llm_complete": "Generation complete.",
        "llm_failed": "Generation failed.",
        "scope_label": "Scope",
        "scope_course": "Course: {name}",
        "scope_paper": "Paper: {name}",
        "scope_slides": "Slides: {name}",
        "scope_paper_aggregate": "Paper aggregation: {count} papers",
        "import_source_label": "Import source",
        "import_source_help": "Choose where your files come from.",
        "import_source_upload": "Upload files",
        "import_source_zotero": "Zotero",
        "import_source_folder": "Folder",
        "import_source_arxiv": "arXiv/DOI/URL",
        "import_attach_title": "Attach imported documents",
        "import_classified_as": "Auto-classified as {category}",
        "category_course": "Course",
        "category_paper": "Paper",
        "category_other": "Other",
        "attach_course": "Attach to course",
        "attach_paper": "Attach as paper",
        "attach_general_course": "Attach general doc to course",
        "recommended_course": "Recommended course",
        "no_courses": "No courses yet. Create one in Create → Course.",
        "attach_now": "Attach now",
        "attached_success": "Attached.",
        "attach_failed": "Attachment failed.",
        "classification_notes": "We use filename hints and paper metadata to classify.",
        "start_title": "Home",
        "start_select_project": "Select or create a project to begin.",
        "setup_checklist": "Setup checklist",
        "setup_llm": "LLM",
        "setup_retrieval": "Retrieval",
        "setup_ocr": "OCR",
        "setup_workspace": "Workspace",
        "open_settings": "Open Settings",
        "workspace_path": "Workspace path",
        "setup_incomplete": "Complete setup before generating outputs.",
        "library_title": "Library",
        "library_select_project": "Select or create a project to view the library.",
        "create_title": "Create Studio",
        "create_select_project": "Select or create a project to continue.",
        "tools_title": "Toolbox",
        "tools_select_project": "Select or create a project to continue.",
        "import_auto_title": "Import & Auto-Process",
        "import_auto_subtitle": "One click to ingest and index",
        "import_auto_subtitle_library": "Upload or sync and auto-build index",
        "import_tabs_upload": "Upload files",
        "import_tabs_zotero": "Zotero",
        "import_tabs_folder": "Folder",
        "import_tabs_arxiv": "arXiv/DOI/URL",
        "upload_pdfs": "Upload PDFs",
        "upload_documents": "Upload files",
        "upload_documents_help": "PDF, TXT/MD, DOCX, PPTX, HTML, PNG/JPG (OCR required for images).",
        "import_now": "Import now",
        "importing_processing": "Importing and processing…",
        "import_complete": "Import complete",
        "import_failed": "Import failed",
        "import_failed_error": "Import failed.",
        "import_success_auto": "Import complete. Status will update automatically.",
        "zotero_data_dir": "Zotero data dir",
        "import_from_zotero": "Import from Zotero",
        "folder_path": "Folder path",
        "folder_path_placeholder": "/Users/yourname/Documents/papers",
        "folder_path_help": "Drag folder from Finder to terminal to get path, or copy path from Finder (right-click > Get Info)",
        "zotero_path_placeholder": "/Users/yourname/Zotero",
        "zotero_path_help": "Usually at ~/Zotero or check Zotero preferences > Advanced > Data Directory",
        "import_from_folder": "Import from Folder",
        "source_id_label": "arXiv ID / DOI / URL",
        "source_id_placeholder": "e.g. 2301.07041 or 10.1038/nature12373 or https://...",
        "source_id_help": "arXiv: 2301.07041 | DOI: 10.1038/nature12373 | URL: https://example.com/paper.pdf",
        "import_from_arxiv": "Import from arXiv",
        "import_from_doi": "Import from DOI",
        "import_from_url": "Import from URL",
        "ask_title": "Ask (Search + Cite)",
        "ask_subtitle": "Ask questions over your latest materials",
        "open_ask": "Open Ask",
        "ask_question": "Ask a question",
        "ask_button": "Ask",
        "answer_heading": "Answer",
        "generate_title": "Generate (One-click outputs)",
        "generate_subtitle": "Pick a recent source and go",
        "open_create_course": "Open Create (Course)",
        "open_create_paper": "Open Create (Paper)",
        "open_create_slides": "Open Create (Slides)",
        "open_import": "Open Import",
        "import_docs_to_generate": "Import documents to enable generation.",
        "source_label": "Source",
        "course_for_overview": "Course for overview",
        "linked_pdfs": "Linked PDFs",
        "course_overview": "Course Overview",
        "course_overview_help": "Generate a comprehensive overview of the course content.",
        "generate_overview_btn": "Generate Overview",
        "cheat_sheet_help": "Generate a quick review cheat sheet with key concepts and formulas.",
        "generate_cheatsheet_btn": "Generate Cheat Sheet",
        "course_qa": "Knowledge Q&A",
        "course_qa_help": "Ask questions about the course content and get answers based on the linked materials.",
        "course_question_label": "Your question",
        "course_question_help": "Ask a specific question about the linked course materials.",
        "course_question_placeholder": "e.g. What is the main theorem discussed in lecture 3?",
        "answer_question_btn": "Get Answer",
        "explain_selection_help": "Paste text from your course materials and get an explanation in the selected mode.",
        "explain_selection_btn": "Generate Explanation",
        "paper_card": "Paper Card",
        "paper_card_section": "Single Paper Card",
        "paper_card_help": "Generate a structured summary card for one paper, including: summary, key contributions, strengths, weaknesses, and extension ideas.",
        "generate_paper_card": "Generate Paper Card",
        "paper_aggregate_section": "Multi-Paper Comparison",
        "paper_aggregate_help": "Compare and synthesize multiple papers around a specific research question. Generates: consensus, disagreements, method branches, and related work draft.",
        "select_papers_to_compare": "Select papers to compare",
        "select_papers_help": "Select at least 2 papers to compare",
        "aggregation_question": "Research question for comparison",
        "aggregation_question_placeholder": "e.g. How do different attention mechanisms compare?",
        "aggregation_question_help": "Ask a specific research question to compare the selected papers around",
        "aggregate_button_help": "Select at least 2 papers and enter a question",
        "slides_deck": "Slides Deck",
        "recent_activity": "Recent Activity",
        "no_recent_activity": "No recent activity.",
        "tasks_in_progress": "In progress",
        "select_activity": "Select activity",
        "activity_type": "Type",
        "activity_title": "Title",
        "activity_status": "Status",
        "scope_course_only": "Scope: course-only",
        "scope_paper_only": "Scope: paper-only",
        "scope_all_docs": "Scope: all-docs",
        "open_recent_activity": "Open Recent Activity",
        "download_output": "Download output",
        "latest_output": "Latest Output",
        "generation_status": "Generation status",
        "generation_status_empty": "No generation tasks yet.",
        "qa_heading": "Q&A",
        "documents": "Documents",
        "chunks": "Chunks",
        "vector_items": "Vector items",
        "bm25_ready": "Ready",
        "bm25_missing": "Missing",
        "import_section": "Import",
        "no_documents_yet": "No documents yet. Import files to get started.",
        "search_documents": "Search documents",
        "search_documents_placeholder": "Search by filename",
        "sort_by": "Sort",
        "sort_created_desc": "Newest first",
        "sort_created_asc": "Oldest first",
        "sort_filename_asc": "Filename A-Z",
        "sort_filename_desc": "Filename Z-A",
        "sort_size_asc": "Size small → large",
        "sort_size_desc": "Size large → small",
        "material_type": "Material type",
        "material_type_help": "Filter library by Course / Paper / Other.",
        "page_size": "Page size",
        "page_number": "Page",
        "page_summary": "Page {current} of {total} · {count} items",
        "filter_by_tags": "Filter by tags",
        "filter_by_type": "Filter by type",
        "all_types": "All types",
        "no_docs_match": "No documents match the current filters.",
        "select_document": "Select document",
        "document_details": "Document details",
        "filename": "Filename",
        "doc_id": "ID",
        "doc_type_label": "Doc type",
        "doc_type_help": "Choose how this material should be used in Create workflows.",
        "source": "Source",
        "created": "Created",
        "summary_label": "Summary",
        "generate_summary": "Generate Summary",
        "updated_at": "Updated",
        "document": "Document",
        "path": "Path",
        "pages": "Pages",
        "select_document_to_inspect": "Select a document to inspect.",
        "tags_label": "Tags: {tags}",
        "none": "None",
        "add_tags": "Add tags (comma separated)",
        "update_tags": "Update tags",
        "tags_updated": "Tags updated.",
        "tags_update_failed": "Tag update failed.",
        "update_doc_type": "Update doc type",
        "doc_type_updated": "Doc type updated.",
        "doc_type_update_failed": "Doc type update failed.",
        "actions": "Actions",
        "rebuild_index": "Rebuild index",
        "rebuild_index_done": "Index rebuild completed.",
        "rebuild_index_queued": "Index rebuild queued.",
        "rebuild_index_failed": "Index rebuild failed.",
        "confirm_delete": "Confirm delete",
        "delete_document": "Delete document",
        "document_deleted": "Document deleted.",
        "delete_failed": "Delete failed.",
        "pages_label": "pages",
        "status_processing": "Processing",
        "status_imported": "Imported",
        "status_search_ready": "Search Ready",
        "status_indexing": "Indexing",
        "imported_doc": "Imported {name}",
        "failed_load_documents": "Failed to load documents.",
        "course_tab": "Course Sprint",
        "paper_tab": "Paper Review",
        "presentation_tab": "Presentation Builder",
        "create_tabs": "Create tabs",
        "step1_select_or_create_course": "Step 1 — Select or create course",
        "course_label": "Course",
        "course_label_help": "Select which course these documents belong to.",
        "new_course_name": "New course name",
        "new_course_name_help": "Create a new course name if you don't have one.",
        "create_course": "Create course",
        "course_created": "Course created.",
        "linked_pdfs_count": "Linked PDFs: {count}",
        "step2_link_documents": "Step 2 — Link documents",
        "import_course_docs": "Import course documents to continue.",
        "select_lecture_pdfs": "Select lecture PDFs",
        "select_lecture_help": "Choose which documents should be linked to this course.",
        "link_documents_to_course": "Link documents to course",
        "documents_linked": "Documents linked.",
        "step3_generate": "Step 3 — Generate",
        "cheat_sheet": "Cheat Sheet",
        "explain_mode": "Explain mode",
        "explain_mode_help": "Pick the style of explanation you want.",
        "explain_mode_concept": "concept",
        "explain_mode_proof": "proof",
        "explain_mode_example": "example",
        "explain_mode_summary": "summary",
        "selection_to_explain": "Selection to explain",
        "selection_help": "Paste a short excerpt from your materials.",
        "explain_selection": "Explain selection",
        "step1_pick_paper": "Step 1 — Pick a paper",
        "import_papers_to_continue": "Import papers to continue.",
        "paper_source": "Paper source",
        "paper_source_help": "Choose a paper to summarize or analyze.",
        "step2_generate": "Step 2 — Generate",
        "comparison_question": "Comparison question",
        "compare_papers": "Compare papers",
        "aggregate_papers": "Aggregate Papers",
        "step1_choose_source": "Step 1 — Choose source",
        "import_docs_for_slides": "Import documents to build slides.",
        "slides_source": "Slides source",
        "slides_source_help": "Pick a document to build slides from.",
        "duration_minutes": "Duration (minutes)",
        "duration_help": "Estimated talk length for the generated deck.",
        "generate_slides": "Generate Slides",
        "study_coach": "Study Coach",
        "coach_review": "Coach Review",
        "problem_statement": "Problem statement",
        "problem_help": "Describe the question and any constraints you have.",
        "start_coaching": "Start coaching",
        "phase_a_complete": "Phase A complete.",
        "session": "Session",
        "session_name_label": "Session name (optional)",
        "session_name_placeholder": "e.g. Linear Algebra Chapter 1",
        "session_name_help": "Give this session a memorable name for later.",
        "select_session_placeholder": "Select a session",
        "rename_session": "Rename session",
        "new_session_name": "New name",
        "save_name_btn": "Save name",
        "session_renamed": "Session renamed successfully.",
        "your_answer": "Your answer",
        "answer_help": "Paste your attempt. The coach will review it objectively first.",
        "submit_answer": "Submit answer",
        "phase_b_complete": "Phase B complete.",
        "session_details": "Session details",
        "phase_a_output": "Phase A output",
        "phase_b_output": "Phase B review",
        "phase_b_pending": "Phase B not submitted yet.",
        "retrieval_label": "Retrieval",
        "tabs_coach": "Study Coach",
        "tabs_tasks": "Task Center",
        "tabs_exports": "Exports",
        "tabs_plugins": "Plugins",
        "tabs_diagnostics": "Diagnostics",
        "tabs_recent_activity": "Recent Activity",
        "tabs_settings": "Settings",
        "plugins_center_title": "Plugins",
        "plugins_select_project": "Select a project to run plugins.",
        "plugins_empty": "No plugins available.",
        "plugin_label": "Plugin",
        "plugin_args_label": "Plugin settings (JSON)",
        "plugin_args_help": "Provide settings in JSON format.",
        "run_plugin": "Run plugin",
        "plugin_args_invalid": "Settings must be valid JSON.",
        "tabs_help": "Help",
        "help_title": "Help Center",
        "help_caption": "Use the sections below to learn the workflow and troubleshoot issues.",
        "help_search": "Search help",
        "help_search_placeholder": "Search by keyword",
        "help_contents": "Contents",
        "settings_title": "Settings",
        "settings_caption": "Provider settings are stored locally and do not leave your machine.",
        "ui_mode": "UI Mode",
        "ui_mode_direct": "Direct",
        "ui_mode_api": "API",
        "ui_mode_help": "Direct calls local services. API uses FastAPI endpoints.",
        "api_base_url": "API Base URL",
        "api_base_url_help": "Only used in API mode. Example: http://127.0.0.1:8000",
        "llm_base_url": "LLM Base URL",
        "llm_base_url_help": "Your model provider endpoint (e.g. OpenAI-compatible URL).",
        "llm_model": "LLM Model",
        "llm_model_help": "Model name or ID for your provider.",
        "llm_api_key": "LLM API Key",
        "llm_api_key_help": "Stored locally; never committed to the repo.",
        "temperature": "Temperature",
        "temperature_help": "Lower = more deterministic, higher = more creative.",
        "embedding_model_optional": "Embedding model (optional)",
        "embedding_model_help": "Only needed for custom embedding backends.",
        "ocr_settings": "OCR Settings",
        "ocr_mode": "OCR mode",
        "ocr_mode_off": "Off",
        "ocr_mode_auto": "Auto",
        "ocr_mode_on": "On",
        "ocr_mode_help": "Auto triggers OCR on low-text pages.",
        "ocr_threshold": "OCR threshold (chars)",
        "ocr_threshold_help": "Minimum characters before OCR is triggered in auto mode.",
        "prompt_version": "Prompt Version",
        "prompt_version_label": "Prompt version",
        "prompt_version_help": "Select prompt version for generation and coach.",
        "save_settings": "Save settings",
        "save_settings_primary": "Save settings",
        "settings_saved": "Settings saved.",
        "connection_tests": "Connection tests",
        "ping_api": "Ping API server",
        "api_error": "API error {status}: {text}",
        "api_responded": "API responded: {response}",
        "api_ping_failed": "API ping failed: {error}",
        "test_llm": "Test LLM connection",
        "llm_test_prompt": "Reply with 'OK' if you can read this.",
        "llm_responded": "LLM responded: {response}",
        "llm_test_failed": "LLM test failed: {error}",
        "test_embedding": "Test embedding model",
        "embedding_loaded": "Embedding model loaded successfully.",
        "embedding_test_failed": "Embedding test failed: {error}",
        "storage": "Storage",
        "active_workspace": "Active workspace: {workspace}",
        "indexes_path": "Indexes: {path}",
        "runs_path": "Runs: {path}",
        "outputs_path": "Outputs: {path}",
        "backup_tip": "Backup tip: copy the workspace folder to another location.",
        "reset_demo_projects": "Reset demo projects",
        "reset_demo_done": "Demo projects reset.",
        "retrieval_mode": "Retrieval mode",
        "default_mode": "Default mode",
        "save_retrieval_mode": "Save retrieval mode",
        "retrieval_mode_saved": "Retrieval mode saved.",
        "doc_type_course": "Course",
        "doc_type_paper": "Paper",
        "doc_type_other": "Other",
        "doc_type_suggested": "Suggested: {value}",
        "doc_type_other_note": "Other docs are reference-only; they are not linked to courses or papers.",
        "doc_type_filter": "Filter by type",
        "slides_source_filter_help": "Limit slide sources by material type.",
        "all_docs": "All",
        "no_docs_in_category": "No documents in this category.",
        "back_to_start": "Back to Start",
        "filter_by_course": "Filter by course",
        "course_filter_help": "Only show documents linked to a specific course.",
        "all_course_docs_label": "All course documents",
        "uncategorized_course_docs": "Uncategorized course docs",
        "task_queued": "Task queued. Check Tasks or Recent Activity.",
        "task_status_queued": "Queued",
        "task_status_running": "Running",
        "task_status_succeeded": "Completed",
        "task_status_failed": "Failed",
        "task_status_cancelled": "Cancelled",
        "task_completed": "Task completed successfully!",
        "task_failed": "Task failed.",
        "task_cancelled": "Task was cancelled.",
        "tasks_center_title": "Tasks Center",
        "tasks_select_project": "Select a project to view tasks.",
        "tasks_status_filter": "Status filter",
        "all_status": "All",
        "tasks_empty": "No tasks yet. Import or index to create tasks.",
        "tasks_status_line": "Status: {status} · Updated: {updated}",
        "task_action_run": "Run",
        "task_action_cancel": "Cancel",
        "task_action_retry": "Retry",
        "task_action_resume": "Resume",
        "task_scheduled": "Task scheduled.",
        "task_cancelled_msg": "Task cancelled.",
        "task_retried": "Task retried.",
        "task_resumed": "Task resumed.",
        "notification_center": "Notifications",
        "notification_task": "Task update",
        "notification_view": "View",
        "notification_dismiss": "Dismiss",
        "completed_at": "Completed",
        "unknown_file": "unknown file",
        "notification_ingest_summary": "Imported {name}",
        "notification_generate_summary": "{name} generated",
        "notification_ask_summary": "Answer ready",
        "notification_index_summary": "Index updated",
        "notification_generic_summary": "Task finished",
        "task_type_ingest": "Ingest",
        "task_type_ingest_index": "Ingest + Index",
        "task_type_index": "Index rebuild",
        "task_type_ask": "Ask",
        "task_type_generate_course_overview": "Course overview",
        "task_type_generate_course_cheatsheet": "Course cheat sheet",
        "task_type_generate_course_explain": "Course explain",
        "task_type_generate_course_qa": "Course Q&A",
        "task_type_generate_paper_card": "Paper card",
        "task_type_generate_paper_aggregate": "Paper comparison",
        "task_type_generate_slides": "Presentation",
        "task_action_course_overview": "Course overview",
        "task_action_course_cheatsheet": "Course cheat sheet",
        "task_action_course_explain": "Course explain",
        "task_action_course_qa": "Course Q&A",
        "task_action_paper_card": "Paper card",
        "task_action_paper_aggregate": "Paper comparison",
        "task_action_slides": "Presentation",
        "load_demo_data": "Load Demo Data",
        "demo_loading": "Demo data loading... Check Tasks for progress.",
        "demo_not_found": "Demo PDF not found. Check examples/ directory.",
        "run_doctor": "Run Doctor",
        "run_doctor_deep": "Run doctor (deep)",
        "doctor_no_output": "Doctor completed with no output.",
        "diagnostics_title": "Diagnostics",
        "diagnostics_caption": "Health checks, index maintenance, and cleanup tools.",
        "diagnostics_select_project": "Select a project to run diagnostics.",
        "index_status_title": "Index status",
        "index_status_failed": "Index status failed: {error}",
        "vacuum_index": "Vacuum index",
        "vacuum_complete": "Vacuum complete: {result}",
        "storage_cleanup_title": "Storage cleanup",
        "storage_cleanup_caption": "Default is dry-run. Confirm before deleting files.",
        "cleanup_cache": "Cache",
        "cleanup_outputs": "Outputs",
        "cleanup_exports": "Exports",
        "cleanup_dry_run": "Dry-run",
        "cleanup_confirm": "Confirm delete",
        "cleanup_targets": "Targets:",
        "run_cleanup": "Run cleanup",
        "cleanup_dry_run_only": "Dry-run only. Disable dry-run and confirm to apply.",
        "cleanup_complete": "Cleanup complete.",
        "workspace_layout": "Workspace layout",
        "retry_task": "Retry Task",
        "error_recovery_hint": "Try: Run Doctor, Retry Task, or Rebuild Index",
    },
    "zh": {
        "app_title": "StudyFlow-AI",
        "nav_start": "首页",
        "nav_library": "资料库",
        "nav_create": "生成中心",
        "nav_tools": "工具箱",
        "nav_help": "帮助中心",
        "settings": "设置",
        "exit_app": "退出 / 关闭",
        "exit_choice": "退出选项",
        "exit_wait": "等待任务完成",
        "exit_force": "强制退出",
        "exit_shutting_down": "正在关闭...请手动关闭浏览器标签页。",
        "exit_tasks_running": "有任务正在运行，退出时将被取消。",
        "confirm_exit": "确认退出",
        "exit_confirm_prompt": "这将关闭应用，可稍后重新打开浏览器标签页。",
        "cancel_exit": "取消",
        "refresh_app": "刷新",
        "project": "项目",
        "new_project": "(新项目)",
        "new_project_name": "新项目名称",
        "create_project": "创建项目",
        "navigation": "导航",
        "go_to": "前往",
        "projects_caption": "项目与导航",
        "project_select_help": "选择已有项目或创建新项目。",
        "project_created": "项目已创建。",
        "start_caption": "导入 → 处理 → 提问或生成",
        "library_caption": "检索、查看并管理你的资料。",
        "create_caption": "课程速成 / 论文分析 / 汇报生成。",
        "tools_caption": "教练、任务、诊断与设置集中管理。",
        "tools_tabs": "工具页签",
        "inspector": "检查器",
        "collapse_inspector": "折叠检查器",
        "inspector_collapsed": "检查器已折叠。",
        "status": "状态",
        "citations": "引用",
        "no_citations": "暂无引用。",
        "no_output": "暂无输出。",
        "exports": "导出",
        "exports_center_title": "导出中心",
        "exports_select_project": "请选择项目进行导入或导出。",
        "workspace_bundle": "工作区打包",
        "include_pdfs": "包含 PDF",
        "include_assets": "包含资产",
        "include_prompts": "包含提示词",
        "output_path_optional": "输出路径（可选）",
        "export_bundle": "导出打包",
        "bundle_exported": "打包已导出：{path}",
        "import_bundle_path": "导入包路径",
        "rebuild_index_after_import": "导入后重建索引",
        "import_bundle": "导入打包",
        "bundle_imported": "已导入到项目：{workspace}",
        "submission_pack": "提交包",
        "pack_type": "包类型",
        "pack_type_slides": "演示",
        "pack_type_exam": "考试",
        "pack_type_related": "关联",
        "pack_source_id": "来源 ID（文档/课程/项目）",
        "build_pack": "构建提交包",
        "pack_created": "提交包已生成：{path}",
        "versions": "版本",
        "history": "历史",
        "language": "语言",
        "output_language": "输出语言",
        "output_language_help": "控制生成内容的语言。",
        "ui_language": "界面语言",
        "ui_language_help": "切换界面所有文案。",
        "theme_label": "主题",
        "theme_light": "明亮",
        "theme_dark": "深色",
        "theme_help": "在浅色与深色界面间切换。",
        "english": "英文",
        "chinese": "中文",
        "model_unknown": "默认模型",
        "llm_generating": "使用 {model} 生成中…",
        "llm_querying": "检索并使用 {model} 生成中…",
        "llm_complete": "生成完成。",
        "llm_failed": "生成失败。",
        "scope_label": "范围",
        "scope_course": "课程：{name}",
        "scope_paper": "论文：{name}",
        "scope_slides": "演示：{name}",
        "scope_paper_aggregate": "论文聚合：{count} 篇",
        "import_source_label": "导入来源",
        "import_source_help": "选择文件的导入来源。",
        "import_source_upload": "上传文件",
        "import_source_zotero": "Zotero",
        "import_source_folder": "文件夹",
        "import_source_arxiv": "arXiv/DOI/URL",
        "import_attach_title": "关联导入文档",
        "import_classified_as": "自动分类为 {category}",
        "category_course": "课程",
        "category_paper": "论文",
        "category_other": "其他",
        "attach_course": "关联到课程",
        "attach_paper": "关联为论文",
        "attach_general_course": "将通用文档关联到课程",
        "recommended_course": "推荐课程",
        "no_courses": "暂无课程，请在创作 → 课程中创建。",
        "attach_now": "立即关联",
        "attached_success": "已关联。",
        "attach_failed": "关联失败。",
        "classification_notes": "分类依据文件名提示与论文元数据。",
        "start_title": "首页",
        "start_select_project": "请选择或创建项目以开始。",
        "setup_checklist": "初始化检查",
        "setup_llm": "LLM",
        "setup_retrieval": "检索",
        "setup_ocr": "OCR",
        "setup_workspace": "工作区",
        "open_settings": "打开设置",
        "workspace_path": "工作区路径",
        "setup_incomplete": "请先完成设置再生成输出。",
        "library_title": "资料库",
        "library_select_project": "请选择或创建项目以查看资料库。",
        "create_title": "生成中心",
        "create_select_project": "请选择或创建项目以继续。",
        "tools_title": "工具箱",
        "tools_select_project": "请选择或创建项目以继续。",
        "import_auto_title": "导入与自动处理",
        "import_auto_subtitle": "一键完成导入与索引",
        "import_auto_subtitle_library": "上传或同步并自动构建索引",
        "import_tabs_upload": "上传文件",
        "import_tabs_zotero": "Zotero",
        "import_tabs_folder": "文件夹",
        "import_tabs_arxiv": "arXiv/DOI/URL",
        "upload_pdfs": "上传 PDF",
        "upload_documents": "上传文件",
        "upload_documents_help": "支持 PDF、TXT/MD、DOCX、PPTX、HTML、PNG/JPG（图片需 OCR）。",
        "import_now": "立即导入",
        "importing_processing": "导入与处理中…",
        "import_complete": "导入完成",
        "import_failed": "导入失败",
        "import_failed_error": "导入失败。",
        "import_success_auto": "导入完成，状态将自动刷新。",
        "zotero_data_dir": "Zotero 数据目录",
        "import_from_zotero": "从 Zotero 导入",
        "folder_path": "文件夹路径",
        "folder_path_placeholder": "/Users/你的用户名/Documents/papers",
        "folder_path_help": "可从 Finder 拖拽文件夹到输入框获取路径，或右键文件夹 > 显示简介 > 复制路径",
        "zotero_path_placeholder": "/Users/你的用户名/Zotero",
        "zotero_path_help": "通常在 ~/Zotero，或在 Zotero 偏好设置 > 高级 > 数据存储位置 中查看",
        "import_from_folder": "从文件夹导入",
        "source_id_label": "arXiv ID / DOI / URL",
        "source_id_placeholder": "例如 2301.07041 或 10.1038/nature12373 或 https://...",
        "source_id_help": "arXiv: 2301.07041 | DOI: 10.1038/nature12373 | URL: https://example.com/paper.pdf",
        "import_from_arxiv": "从 arXiv 导入",
        "import_from_doi": "从 DOI 导入",
        "import_from_url": "从 URL 导入",
        "ask_title": "提问（检索 + 引用）",
        "ask_subtitle": "基于最新资料提问",
        "open_ask": "进入提问",
        "ask_question": "输入问题",
        "ask_button": "提问",
        "answer_heading": "回答",
        "generate_title": "生成（一键输出）",
        "generate_subtitle": "选择最近的资料并生成",
        "open_create_course": "进入创作（课程）",
        "open_create_paper": "进入创作（论文）",
        "open_create_slides": "进入创作（演示）",
        "open_import": "进入导入",
        "import_docs_to_generate": "请先导入文档以启用生成。",
        "source_label": "来源",
        "course_for_overview": "用于概览的课程",
        "linked_pdfs": "已关联 PDF",
        "course_overview": "课程总览",
        "course_overview_help": "生成课程内容的综合概览。",
        "generate_overview_btn": "生成概览",
        "cheat_sheet_help": "生成包含重点概念和公式的快速复习小抄。",
        "generate_cheatsheet_btn": "生成复习备忘",
        "course_qa": "知识问答",
        "course_qa_help": "基于关联的课程材料，提问并获取答案。",
        "course_question_label": "你的问题",
        "course_question_help": "围绕已关联课程材料提出具体问题。",
        "course_question_placeholder": "例如：第3讲讨论的主要定理是什么？",
        "answer_question_btn": "获取答案",
        "explain_selection_help": "粘贴课程材料中的文本，按所选模式生成解释。",
        "explain_selection_btn": "生成解释",
        "paper_card": "论文卡片",
        "paper_card_section": "单篇论文卡片",
        "paper_card_help": "为单篇论文生成结构化摘要卡片，包括：摘要、主要贡献、优点、缺点和扩展思路。",
        "generate_paper_card": "生成论文卡片",
        "paper_aggregate_section": "多论文对比分析",
        "paper_aggregate_help": "围绕特定研究问题对比和综合多篇论文，生成：共识、分歧、方法路线分支和相关工作草稿。",
        "select_papers_to_compare": "选择要对比的论文",
        "select_papers_help": "至少选择 2 篇论文进行对比",
        "aggregation_question": "对比研究问题",
        "aggregation_question_placeholder": "例如：不同的注意力机制有何优劣？",
        "aggregation_question_help": "输入一个具体的研究问题，围绕该问题对比所选论文",
        "aggregate_button_help": "请至少选择 2 篇论文并输入问题",
        "slides_deck": "演示稿",
        "recent_activity": "最近活动",
        "no_recent_activity": "暂无最近活动。",
        "tasks_in_progress": "进行中",
        "select_activity": "选择活动",
        "activity_type": "类型",
        "activity_title": "标题",
        "activity_status": "状态",
        "scope_course_only": "范围：仅课程",
        "scope_paper_only": "范围：仅论文",
        "scope_all_docs": "范围：全部文档",
        "open_recent_activity": "打开最近活动",
        "download_output": "下载输出",
        "latest_output": "最新输出",
        "generation_status": "生成进度",
        "generation_status_empty": "暂无生成任务。",
        "qa_heading": "问答",
        "documents": "文档",
        "chunks": "切块",
        "vector_items": "向量条目",
        "bm25_ready": "就绪",
        "bm25_missing": "缺失",
        "import_section": "导入",
        "no_documents_yet": "暂无文档，请先导入文件。",
        "search_documents": "搜索文档",
        "search_documents_placeholder": "按文件名搜索",
        "sort_by": "排序",
        "sort_created_desc": "最新优先",
        "sort_created_asc": "最早优先",
        "sort_filename_asc": "文件名 A-Z",
        "sort_filename_desc": "文件名 Z-A",
        "sort_size_asc": "大小从小到大",
        "sort_size_desc": "大小从大到小",
        "material_type": "资料类型",
        "material_type_help": "按课程/论文/其他过滤资料库。",
        "page_size": "每页数量",
        "page_number": "页码",
        "page_summary": "第 {current}/{total} 页 · 共 {count} 条",
        "filter_by_tags": "按标签过滤",
        "filter_by_type": "按类型过滤",
        "all_types": "全部类型",
        "no_docs_match": "没有符合当前筛选条件的文档。",
        "select_document": "选择文档",
        "document_details": "文档详情",
        "filename": "文件名",
        "doc_id": "ID",
        "doc_type_label": "文档类型",
        "doc_type_help": "选择该资料在创作流程中的用途。",
        "source": "来源",
        "created": "创建时间",
        "summary_label": "简介",
        "generate_summary": "生成简介",
        "updated_at": "更新时间",
        "document": "文档",
        "path": "路径",
        "pages": "页数",
        "select_document_to_inspect": "请选择文档以查看详情。",
        "tags_label": "标签：{tags}",
        "none": "无",
        "add_tags": "添加标签（逗号分隔）",
        "update_tags": "更新标签",
        "tags_updated": "标签已更新。",
        "tags_update_failed": "标签更新失败。",
        "update_doc_type": "更新文档类型",
        "doc_type_updated": "文档类型已更新。",
        "doc_type_update_failed": "文档类型更新失败。",
        "actions": "操作",
        "rebuild_index": "重建索引",
        "rebuild_index_done": "索引重建完成。",
        "rebuild_index_queued": "索引重建已排队。",
        "rebuild_index_failed": "索引重建失败。",
        "confirm_delete": "确认删除",
        "delete_document": "删除文档",
        "document_deleted": "文档已删除。",
        "delete_failed": "删除失败。",
        "pages_label": "页",
        "status_processing": "处理中",
        "status_imported": "已导入",
        "status_search_ready": "可检索",
        "status_indexing": "索引中",
        "imported_doc": "已导入 {name}",
        "failed_load_documents": "加载文档失败。",
        "course_tab": "课程速成",
        "paper_tab": "论文分析",
        "presentation_tab": "汇报生成",
        "create_tabs": "创作页签",
        "step1_select_or_create_course": "步骤 1 — 选择或创建课程",
        "course_label": "课程",
        "course_label_help": "选择这些文档归属的课程。",
        "new_course_name": "新课程名称",
        "new_course_name_help": "若没有课程可在此创建。",
        "create_course": "创建课程",
        "course_created": "课程已创建。",
        "linked_pdfs_count": "已关联 PDF：{count}",
        "step2_link_documents": "步骤 2 — 关联文档",
        "import_course_docs": "请先导入课程资料。",
        "select_lecture_pdfs": "选择课件 PDF",
        "select_lecture_help": "选择要关联到该课程的文档。",
        "link_documents_to_course": "关联文档到课程",
        "documents_linked": "文档已关联。",
        "step3_generate": "步骤 3 — 生成",
        "cheat_sheet": "速查表",
        "explain_mode": "讲解模式",
        "explain_mode_help": "选择讲解的风格。",
        "explain_mode_concept": "概念",
        "explain_mode_proof": "证明",
        "explain_mode_example": "例子",
        "explain_mode_summary": "总结",
        "selection_to_explain": "要讲解的片段",
        "selection_help": "粘贴课程材料中的短文本。",
        "explain_selection": "讲解片段",
        "step1_pick_paper": "步骤 1 — 选择论文",
        "import_papers_to_continue": "请先导入论文。",
        "paper_source": "论文来源",
        "paper_source_help": "选择要分析的论文。",
        "step2_generate": "步骤 2 — 生成",
        "comparison_question": "对比问题",
        "compare_papers": "对比论文",
        "aggregate_papers": "聚合论文",
        "step1_choose_source": "步骤 1 — 选择来源",
        "import_docs_for_slides": "请先导入文档以生成演示。",
        "slides_source": "演示来源",
        "slides_source_help": "选择生成演示的文档。",
        "duration_minutes": "时长（分钟）",
        "duration_help": "生成演示时的预计时长。",
        "generate_slides": "生成演示",
        "study_coach": "学习教练",
        "coach_review": "教练评审",
        "problem_statement": "问题描述",
        "problem_help": "描述问题和限制条件，越具体越好。",
        "start_coaching": "开始辅导",
        "phase_a_complete": "阶段 A 完成。",
        "session": "会话",
        "session_name_label": "会话名称（可选）",
        "session_name_placeholder": "例如：线性代数第一章",
        "session_name_help": "为会话命名，方便之后查找。",
        "select_session_placeholder": "选择一个会话",
        "rename_session": "重命名会话",
        "new_session_name": "新名称",
        "save_name_btn": "保存名称",
        "session_renamed": "会话重命名成功。",
        "your_answer": "你的答案",
        "answer_help": "粘贴你的尝试，教练会先给客观评价。",
        "submit_answer": "提交答案",
        "phase_b_complete": "阶段 B 完成。",
        "session_details": "会话详情",
        "phase_a_output": "阶段 A 输出",
        "phase_b_output": "阶段 B 评阅",
        "phase_b_pending": "阶段 B 尚未提交。",
        "retrieval_label": "检索",
        "tabs_coach": "学习教练",
        "tabs_tasks": "任务中心",
        "tabs_exports": "导出",
        "tabs_plugins": "插件",
        "tabs_diagnostics": "系统自检",
        "tabs_recent_activity": "最近活动",
        "tabs_settings": "系统设置",
        "plugins_center_title": "插件中心",
        "plugins_select_project": "请选择项目以运行插件。",
        "plugins_empty": "暂无可用插件。",
        "plugin_label": "插件",
        "plugin_args_label": "插件设置（JSON）",
        "plugin_args_help": "以 JSON 形式填写设置。",
        "run_plugin": "运行插件",
        "plugin_args_invalid": "设置必须是合法 JSON。",
        "tabs_help": "帮助",
        "help_title": "帮助中心",
        "help_caption": "使用下方各节了解工作流和解决问题。",
        "help_search": "搜索帮助",
        "help_search_placeholder": "输入关键词",
        "help_contents": "目录",
        "settings_title": "设置",
        "settings_caption": "提供商配置仅保存在本地，不会离开你的机器。",
        "ui_mode": "界面模式",
        "ui_mode_direct": "本地",
        "ui_mode_api": "API",
        "ui_mode_help": "本地模式调用本地服务，API 模式使用 FastAPI 端点。",
        "api_base_url": "API 基础地址",
        "api_base_url_help": "仅在 API 模式使用。例如：http://127.0.0.1:8000",
        "llm_base_url": "LLM 基础地址",
        "llm_base_url_help": "模型提供方的接口地址（如 OpenAI 兼容接口）。",
        "llm_model": "LLM 模型",
        "llm_model_help": "输入模型名称或 ID。",
        "llm_api_key": "LLM API Key",
        "llm_api_key_help": "仅保存在本地，不会提交到仓库。",
        "temperature": "温度",
        "temperature_help": "越低越稳定，越高越发散。",
        "embedding_model_optional": "Embedding 模型（可选）",
        "embedding_model_help": "仅在自定义 Embedding 后端时需要。",
        "ocr_settings": "OCR 设置",
        "ocr_mode": "OCR 模式",
        "ocr_mode_off": "关闭",
        "ocr_mode_auto": "自动",
        "ocr_mode_on": "开启",
        "ocr_mode_help": "当页面文本较少时自动触发 OCR。",
        "ocr_threshold": "OCR 阈值（字符数）",
        "ocr_threshold_help": "自动模式下触发 OCR 的最小字符数。",
        "prompt_version": "提示词版本",
        "prompt_version_label": "提示词版本",
        "prompt_version_help": "选择生成与教练所使用的提示词版本。",
        "save_settings": "保存设置",
        "save_settings_primary": "保存设置",
        "settings_saved": "设置已保存。",
        "connection_tests": "连接测试",
        "ping_api": "测试 API 服务器",
        "api_error": "API 错误 {status}: {text}",
        "api_responded": "API 响应：{response}",
        "api_ping_failed": "API 测试失败：{error}",
        "test_llm": "测试 LLM 连接",
        "llm_test_prompt": "如果你能读到这段话，请回复 OK。",
        "llm_responded": "LLM 响应：{response}",
        "llm_test_failed": "LLM 测试失败：{error}",
        "test_embedding": "测试 Embedding 模型",
        "embedding_loaded": "Embedding 模型加载成功。",
        "embedding_test_failed": "Embedding 测试失败：{error}",
        "storage": "存储",
        "active_workspace": "当前项目：{workspace}",
        "indexes_path": "索引：{path}",
        "runs_path": "运行日志：{path}",
        "outputs_path": "输出：{path}",
        "backup_tip": "备份提示：复制 workspace 文件夹到其他位置。",
        "reset_demo_projects": "重置示例项目",
        "reset_demo_done": "示例项目已重置。",
        "retrieval_mode": "检索模式",
        "default_mode": "默认模式",
        "save_retrieval_mode": "保存检索模式",
        "retrieval_mode_saved": "检索模式已保存。",
        "doc_type_course": "课程",
        "doc_type_paper": "论文",
        "doc_type_other": "其他",
        "doc_type_suggested": "建议类型：{value}",
        "doc_type_other_note": "其他类型用于参考，不关联课程或论文。",
        "doc_type_filter": "按类型筛选",
        "slides_source_filter_help": "按资料类型限制演示来源。",
        "all_docs": "全部",
        "no_docs_in_category": "该分类下暂无文档。",
        "back_to_start": "返回开始",
        "filter_by_course": "按课程筛选",
        "course_filter_help": "仅显示与指定课程关联的文档。",
        "all_course_docs_label": "全部课程文档",
        "uncategorized_course_docs": "未分类课程文档",
        "task_queued": "任务已排队，请在任务或最近活动中查看。",
        "task_status_queued": "排队中",
        "task_status_running": "运行中",
        "task_status_succeeded": "已完成",
        "task_status_failed": "失败",
        "task_status_cancelled": "已取消",
        "task_completed": "任务已成功完成！",
        "task_failed": "任务失败。",
        "task_cancelled": "任务已取消。",
        "tasks_center_title": "任务中心",
        "tasks_select_project": "请选择项目以查看任务。",
        "tasks_status_filter": "状态筛选",
        "all_status": "全部",
        "tasks_empty": "暂无任务。导入或索引后会生成任务。",
        "tasks_status_line": "状态：{status} · 更新时间：{updated}",
        "task_action_run": "运行",
        "task_action_cancel": "取消",
        "task_action_retry": "重试",
        "task_action_resume": "继续",
        "task_scheduled": "任务已调度。",
        "task_cancelled_msg": "任务已取消。",
        "task_retried": "任务已重试。",
        "task_resumed": "任务已继续。",
        "notification_center": "通知中心",
        "notification_task": "任务通知",
        "notification_view": "查看",
        "notification_dismiss": "忽略",
        "completed_at": "完成时间",
        "unknown_file": "未知文件",
        "notification_ingest_summary": "已导入 {name}",
        "notification_generate_summary": "已生成 {name}",
        "notification_ask_summary": "回答已就绪",
        "notification_index_summary": "索引已更新",
        "notification_generic_summary": "任务已完成",
        "task_type_ingest": "导入",
        "task_type_ingest_index": "导入并索引",
        "task_type_index": "重建索引",
        "task_type_ask": "提问",
        "task_type_generate_course_overview": "课程概览",
        "task_type_generate_course_cheatsheet": "课程速记",
        "task_type_generate_course_explain": "课程讲解",
        "task_type_generate_course_qa": "课程问答",
        "task_type_generate_paper_card": "论文卡片",
        "task_type_generate_paper_aggregate": "论文对比",
        "task_type_generate_slides": "演示稿",
        "task_action_course_overview": "课程概览",
        "task_action_course_cheatsheet": "课程速记",
        "task_action_course_explain": "课程讲解",
        "task_action_course_qa": "课程问答",
        "task_action_paper_card": "论文卡片",
        "task_action_paper_aggregate": "论文对比",
        "task_action_slides": "演示稿",
        "load_demo_data": "加载演示数据",
        "demo_loading": "演示数据加载中...请在任务中查看进度。",
        "demo_not_found": "未找到演示 PDF，请检查 examples/ 目录。",
        "run_doctor": "运行诊断",
        "run_doctor_deep": "运行诊断（深度）",
        "doctor_no_output": "诊断完成，无输出。",
        "diagnostics_title": "系统自检",
        "diagnostics_caption": "健康检查、索引维护与清理工具。",
        "diagnostics_select_project": "请选择项目以运行诊断。",
        "index_status_title": "索引状态",
        "index_status_failed": "索引状态失败：{error}",
        "vacuum_index": "压缩索引",
        "vacuum_complete": "索引压缩完成：{result}",
        "storage_cleanup_title": "存储清理",
        "storage_cleanup_caption": "默认仅预览，确认后才会删除。",
        "cleanup_cache": "缓存",
        "cleanup_outputs": "输出",
        "cleanup_exports": "导出",
        "cleanup_dry_run": "仅预览",
        "cleanup_confirm": "确认删除",
        "cleanup_targets": "目标：",
        "run_cleanup": "执行清理",
        "cleanup_dry_run_only": "当前为预览模式，请取消预览并确认删除。",
        "cleanup_complete": "清理完成。",
        "workspace_layout": "工作区结构",
        "retry_task": "重试任务",
        "error_recovery_hint": "尝试：运行诊断、重试任务或重建索引",
    },
}


def current_language(workspace_id: str | None = None) -> str:
    if workspace_id:
        stored = get_setting(workspace_id, "ui_language")
        if stored:
            st.session_state["ui_language"] = stored
    lang = st.session_state.get("ui_language") or get_setting(None, "ui_language") or "en"
    st.session_state["ui_language"] = lang
    return "zh" if str(lang).lower().startswith("zh") else "en"


def t(key: str, workspace_id: str | None = None, fallback: str | None = None) -> str:
    lang = current_language(workspace_id)
    value = _STRINGS.get(lang, {}).get(key)
    if value is None:
        return fallback or key
    return value
